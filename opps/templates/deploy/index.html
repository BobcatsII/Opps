{% extends 'base.html' %}
{% block title %}Deploy{% endblock %}

{% block content %}
    <div class="row">
        <div class="box col-md-12">
        <div class="box-inner">
        <div class="box-header well" data-original-title="">
            <h2><i class="glyphicon glyphicon-user">环境部署</i></h2>
        </div>
        <div class="box-content">   
    	<div><a class="btn btn-info btn-sm" href="/deploy/create">新增部署</a><p/></div>
        <table  class="table table-striped table-bordered bootstrap-datatable datatable responsive">
        <thead>
        <tr>
            <th>部署时间</th>
            <th>部署项目</th>
            <th>部署版本</th>
            <th>部署IP</th>          
            <th>部署状态</th>   
            <th>操作人员</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        {% for a in op %}
        <tr>
            <td>{{a.dply_date}}</td>
            <td>{{a.dply_item}}</td>
            <td>{{a.dply_version}}</td>
            <td>{{a.dply_ip}}</td>
            <td>{{a.dply_stat}}</td>
            <td>{{a.dply_user}}</td>
            	<td class="center">
            		<a class="btn btn-xs btn-setting btn-success" onclick="getlog({{a.id}},'deploy')">
                    <i class="glyphicon glyphicon-zoom-in icon-white"></i> 部署日志
                </a>
                {% if a.state == "部署成功" %}
                <a class="btn btn-xs btn-danger" onclick="rollback({{a.id}})">
                    回滚到此版本
                </a>
                {% elif a.state == "部署失败" %}
                <a class="btn btn-xs btn-warning" onclick="deploy_again({{a.id}})">
                    重新部署
                </a>
                {% endif %}
                {% if "回滚" in a.state %}
                <a class="btn btn-xs btn-setting btn-info" onclick="getlog({{a.id}},'rollback')">
                    <i class="glyphicon glyphicon-zoom-in icon-white"></i> 回滚日志
                </a>
                {% endif %}
            </td>
        {% endfor %}
        </tr>
        </tbody>
        </table>
        </div>
        </div>
        </div>
    </div>
{% endblock %}

